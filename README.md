# Perfect Align - Web MVP

單人益智解謎遊戲，強調「高精準度」的圖片/方塊對齊與微調操作。專為強迫症玩家設計！

## 技術棧

| 類別 | 選擇 |
|:---|:---|
| 核心語言 | TypeScript |
| 渲染引擎 | Pixi.js v7+ |
| UI 框架 | React 18 |
| 狀態管理 | Zustand |
| 建構工具 | Vite |

## 專案結構

```
src/
├── assets/           # 靜態資源
│   └── levels/       # 關卡設定與圖片
├── components/       # React 組件
│   ├── Game.tsx          # 主遊戲容器
│   ├── GameCanvas.tsx    # Pixi.js 畫布包裝
│   ├── FineTuneOverlay.tsx  # 微調模式覆蓋層
│   ├── PreviewButton.tsx    # 預覽按鈕
│   ├── WinScreen.tsx        # 勝利畫面
│   ├── DebugPanel.tsx       # 除錯面板
│   ├── ReplayPlayer.tsx     # 回放播放器
│   ├── TargetPreview.tsx    # 目標位置預覽
│   └── PixelGrid.tsx        # 像素網格線
├── game/             # 遊戲引擎
│   └── GameEngine.ts     # Pixi.js 遊戲引擎
├── hooks/            # React Hooks
│   └── useResponsiveScale.ts  # 響應式縮放
├── stores/           # Zustand 狀態管理
│   └── gameStore.ts      # 遊戲狀態
├── types/            # TypeScript 型別定義
│   └── index.ts
└── utils/            # 工具函數
    └── index.ts
```

## 開發指令

```bash
# 安裝依賴
pnpm install

# 啟動開發伺服器
pnpm dev

# 建構生產版本
pnpm build

# 預覽生產版本
pnpm preview
```

## 遊戲流程

1. **開始時顯示目標** - 遊戲開始時會展示目標位置 2 秒
2. **拖曳對齊** - 將碎片拖曳到目標位置附近
3. **微調模式** - 雙擊進入精確微調
4. **勝利判定** - 誤差 <15px 即可通關

## 遊戲操作

### 基礎操作
- **拖曳**：單指/滑鼠拖曳方塊移動位置（含 Lerp 平滑）
- **雙擊**：進入微調模式
- **放開時自動對齊**：拖曳結束時自動對齊到格線（依據 snap 設定）

### 微調模式
- **上區點擊**：向上微移（依據 snap 步長）
- **下區點擊**：向下微移（依據 snap 步長）
- **左區點擊**：向左微移（依據 snap 步長）
- **右區點擊**：向右微移（依據 snap 步長）
- **中央點擊**：退出微調模式

### 微調模式 - 旋轉/縮放按鈕
- **左上按鈕 ↺**：逆時針旋轉 -5°（長按持續旋轉）
- **右上按鈕 ↻**：順時針旋轉 +5°（長按持續旋轉）
- **左下按鈕 −**：縮小 -0.05（長按持續縮小）
- **右下按鈕 +**：放大 +0.05（長按持續放大）

### 長按操作（微調模式方向按鈕）
- **長按上/下區**：縮放 ±0.01
- **長按左/右區**：旋轉 ±1°

### 觸控手勢（選取方塊後）
- **雙指旋轉**：旋轉方塊
- **雙指捏合**：縮放方塊

### PC 操作（選取方塊後）
- **Shift + 滾輪**：旋轉 ±5°
- **Ctrl/Cmd + 滾輪**：縮放 ±0.05

### 工具列
- **網格按鈕**：切換像素網格線（10px 間隔，50px 粗線）
- **Snap 按鈕**：切換對齊格線功能
- **Snap 步長選擇**：1px / 5px / 10px（Snap 開啟時顯示）
- **除錯按鈕**：顯示/隱藏 Debug 面板
- **預覽按鈕**：按住查看目標位置

## 勝利評級

| 評級 | 總誤差 | 特效 |
|:---|:---|:---|
| Perfect | < 3px | 金色 ★★★ |
| Great | < 8px | 銀色 ★★☆ |
| Good | < 15px | 銅色 ★☆☆ |

## 功能特色

- **目標預覽**：遊戲開始時展示目標位置
- **像素網格**：Figma 風格的輔助對齊網格（10px/50px）
- **Snap 對齊**：拖曳結束時自動對齊到格線（可選 1/5/10px 步長）
- **優化觸控體驗**：加大的微調按鈕，更適合手機操作
- **響應式設計**：自動縮放適配各種螢幕尺寸
- **平滑拖曳**：Lerp 插值讓移動更順暢
- **回放系統**：勝利後可觀看操作回放，支援變速播放
- **即時誤差顯示**：Debug 面板顯示當前對齊誤差
- **操作記錄**：完整記錄所有操作供回放使用

## 開發進度

### Phase 1 - 基礎架構 ✅
- [x] 專案初始化 (Vite + React + TypeScript)
- [x] 安裝核心依賴 (Pixi.js v7+, Zustand)
- [x] 建立專案基礎結構與型別定義
- [x] 實作遊戲畫布與 Pixi.js 整合
- [x] 實作碎片物件載入與渲染
- [x] 實作基本拖曳操作（含 Lerp 平滑）
- [x] 實作預覽按鈕功能
- [x] 建立測試關卡資料

### Phase 2 - 微調系統 ✅
- [x] 雙擊偵測進入微調模式
- [x] 區域切割（五區判定含中央圓形區）
- [x] 位移操作
- [x] 視覺反饋（方向箭頭 + 點擊波紋）
- [x] 退出機制

### Phase 3 - 旋轉/縮放與判定 ✅
- [x] 長按微調旋轉/縮放
- [x] 勝利判定公式
- [x] 勝利動畫與評級
- [x] 雙指旋轉（觸控）
- [x] 雙指縮放（觸控）
- [x] PC 替代操作（Shift/Ctrl + 滾輪）

### Phase 4 - 回放與優化 ✅
- [x] 操作記錄完整實作
- [x] 回放播放功能（支援變速）
- [x] RWD 響應式適配
- [x] 操作提示 UI

### Phase 5 - 使用者體驗 ✅
- [x] 遊戲開始時目標位置展示
- [x] Figma 風格像素網格線
- [x] 關卡標題顯示
- [x] 工具列按鈕

### Phase 6 - 手機優化與 Snap 功能 ✅
- [x] Snap-to-grid 功能（拖曳時即時對齊格線，產生段落感）
- [x] 可選 snap 步長（1px / 5px / 10px）
- [x] 微調模式使用 snap 步長
- [x] 加大微調按鈕觸控區域
- [x] 改善微調按鈕視覺回饋
- [x] 工具列 snap 開關與步長選擇器
- [x] 微調模式四角添加旋轉/縮放專用按鈕（手機友善）

## 待擴展功能

1. 音效系統
2. 關卡選擇 UI
3. 失敗機制（時間/操作次數限制）
4. 教學關卡
5. 資料持久化（LocalStorage）
6. 實際圖片素材支援
