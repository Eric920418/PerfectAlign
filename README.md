# Perfect Align - Web MVP

單人益智解謎遊戲，強調「高精準度」的圖片/方塊對齊與微調操作。專為強迫症玩家設計！

## 技術棧

| 類別 | 選擇 |
|:---|:---|
| 核心語言 | TypeScript |
| 渲染引擎 | Pixi.js v7+ |
| UI 框架 | React 18 |
| 狀態管理 | Zustand |
| 建構工具 | Vite |

## 專案結構

```
src/
├── assets/           # 靜態資源
│   └── levels/       # 關卡設定與圖片
├── components/       # React 組件
│   ├── Game.tsx          # 主遊戲容器
│   ├── GameCanvas.tsx    # Pixi.js 畫布包裝
│   ├── TransformControls.tsx # 旋轉/縮放控制列
│   ├── PreviewButton.tsx    # 預覽按鈕
│   ├── WinScreen.tsx        # 勝利畫面
│   ├── DebugPanel.tsx       # 除錯面板
│   ├── ReplayPlayer.tsx     # 回放播放器
│   ├── TargetPreview.tsx    # 目標位置預覽（倒數計時）
│   ├── PixelGrid.tsx        # 像素網格線
│   └── SnapFeedback.tsx     # 正確值視覺回饋
├── game/             # 遊戲引擎
│   └── GameEngine.ts     # Pixi.js 遊戲引擎
├── hooks/            # React Hooks
│   ├── useResponsiveScale.ts  # 響應式縮放
│   └── usePinchZoom.ts        # 雙指縮放手勢
├── stores/           # Zustand 狀態管理
│   └── gameStore.ts      # 遊戲狀態
├── types/            # TypeScript 型別定義
│   └── index.ts
└── utils/            # 工具函數
    └── index.ts
```

## 開發指令

```bash
# 安裝依賴
pnpm install

# 啟動開發伺服器
pnpm dev

# 建構生產版本
pnpm build

# 預覽生產版本
pnpm preview
```

## 關卡設計

| 關卡 | 名稱 | 難度 | 碎片數 | 縮放模式 | 說明 |
|:---|:---|:---|:---|:---|:---|
| Level 1 | 入門：移動與旋轉 | ★☆☆☆☆ | 1 | 不需要 | 只需調整位置和旋轉 |
| Level 2 | 進階：等比例縮放 | ★★☆☆☆ | 2 | 等比例 | 位置、旋轉、等比縮放 |
| Level 3 | 挑戰：寬高獨立調整 | ★★★☆☆ | 2 | 獨立寬高 | 需要分別調整寬度和高度 |
| Level 4 | 精準定位 | ★★☆☆☆ | 1 | 不需要 | 微小偏移，考驗精準度 |
| Level 5 | 三元素挑戰 | ★★★☆☆ | 3 | 等比例 | 三個方塊需要精確排列 |
| Level 6 | 角度大師 | ★★★☆☆ | 2 | 等比例 | 精確旋轉角度是關鍵 |
| Level 7 | 混合模式 | ★★★★☆ | 3 | 混合 | 部分方塊需要獨立調整寬高 |
| Level 8 | 四方陣列 | ★★★★☆ | 4 | 等比例 | 四個方塊排成 2x2 網格 |
| Level 9 | 終極考驗 | ★★★★★ | 4 | 獨立寬高 | 全參數調整 |
| Level 10 | 完美主義者 | ★★★★★ | 5 | 獨立寬高 | 最高難度：五個方塊的完美對齊 |

## 遊戲流程

1. **選擇關卡** - 點擊頂部關卡按鈕選擇要挑戰的關卡
2. **開始時顯示目標** - 遊戲開始時會展示目標位置 2 秒
3. **拖曳對齊** - 將碎片拖曳到目標位置
4. **調整旋轉/縮放** - 使用底部控制列調整方塊
5. **勝利判定** - 誤差達到門檻即可通關

## 遊戲操作

### 基礎操作
- **拖曳**：單指/滑鼠拖曳方塊移動位置（含 Lerp 平滑）
- **雙擊**：選取方塊
- **放開時自動對齊**：拖曳結束時自動對齊到格線（依據 snap 設定）
- **雙指縮放+平移**：兩指捏合可放大/縮小遊戲畫面（1x ~ 5x），同時移動雙指中心可平移視窗

### 底部控制列（選取方塊後顯示）
- **↺ / ↻ 旋轉按鈕**：逆時針/順時針旋轉 ±5°（長按持續旋轉）
- **寬 −/+ 按鈕**：調整寬度 ±0.05（長按持續調整）
- **高 −/+ 按鈕**：調整高度 ±0.05（長按持續調整）

### PC 操作（選取方塊後）
- **Shift + 滾輪**：旋轉 ±5°
- **Ctrl/Cmd + 滾輪**：縮放 ±0.05

### 工具列
- **Snap 步長選擇**：1px / 5px / 10px（實際為 5/10/20px，自動調整縮放）
- **預覽按鈕**：按住查看目標位置與輔助定位線
- **重置按鈕**：放大畫面後顯示，點擊可重置視圖

## 勝利評級

| 評級 | 總誤差 | 特效 |
|:---|:---|:---|
| Perfect | < 3px | 金色 ★★★ |
| Great | < 8px | 銀色 ★★☆ |
| Good | < 15px | 銅色 ★☆☆ |

## 功能特色

- **目標預覽**：遊戲開始時展示目標位置
- **像素網格**：Figma 風格的輔助對齊網格（10px/50px）
- **Snap 對齊**：拖曳結束時自動對齊到格線（可選 1/5/10px 步長）
- **自動縮放**：根據精度自動調整畫布（1px→1.2x, 5px→1x, 10px→0.8x）
- **優化觸控體驗**：加大的微調按鈕，更適合手機操作
- **響應式設計**：自動縮放適配各種螢幕尺寸
- **雙指縮放**：類似 Figma 的手勢操作，放大檢視 1px 細節
- **平滑拖曳**：Lerp 插值讓移動更順暢
- **回放系統**：勝利後可觀看操作回放，支援變速播放
- **即時誤差顯示**：Debug 面板顯示當前對齊誤差
- **操作記錄**：完整記錄所有操作供回放使用
- **視覺回饋**：調整到正確角度/大小時顯示酷炫動畫效果

## 開發進度

### Phase 1 - 基礎架構 ✅
- [x] 專案初始化 (Vite + React + TypeScript)
- [x] 安裝核心依賴 (Pixi.js v7+, Zustand)
- [x] 建立專案基礎結構與型別定義
- [x] 實作遊戲畫布與 Pixi.js 整合
- [x] 實作碎片物件載入與渲染
- [x] 實作基本拖曳操作（含 Lerp 平滑）
- [x] 實作預覽按鈕功能
- [x] 建立測試關卡資料

### Phase 2 - 旋轉/縮放與判定 ✅
- [x] 勝利判定公式
- [x] 勝利動畫與評級
- [x] PC 滾輪操作（Shift/Ctrl + 滾輪）
- [x] 底部控制列旋轉/縮放按鈕

### Phase 3 - 回放與優化 ✅
- [x] 操作記錄完整實作
- [x] 回放播放功能（支援變速）
- [x] RWD 響應式適配
- [x] 操作提示 UI

### Phase 4 - 使用者體驗 ✅
- [x] 遊戲開始時目標位置展示
- [x] Figma 風格像素網格線
- [x] 關卡標題顯示
- [x] 工具列按鈕

### Phase 5 - 手機優化與 Snap 功能 ✅
- [x] Snap-to-grid 功能（拖曳時即時對齊格線，產生段落感）
- [x] 可選 snap 步長（1px / 5px / 10px）
- [x] 工具列 snap 開關與步長選擇器
- [x] 底部控制列：旋轉/寬度/高度專用按鈕（手機友善）

### Phase 6 - 精準對齊優化 ✅
- [x] 選取時顯示綠色選取框，對答案時自動隱藏
- [x] 分離 scaleX / scaleY 控制（可單獨調整寬度或高度）
- [x] 獨立的寬/高調整按鈕
- [x] 修復選取新方塊時舊方塊跳動的 bug
- [x] 禁用手機版文字選取框

### Phase 7 - 多關卡系統 ✅
- [x] 關卡選擇下拉選單
- [x] 十個漸進難度關卡設計（★☆☆☆☆ ~ ★★★★★）
- [x] Level 1-3：基礎教學關卡
- [x] Level 4-6：進階技巧關卡
- [x] Level 7-10：挑戰與大師關卡（多碎片、全參數調整）
- [x] 支援自定義碎片形狀（長方形）
- [x] 關卡切換與進度重置

### Phase 8 - 精準對齊工具 ✅
- [x] 自動縮放：根據 snapSize 自動調整畫布放大倍率
- [x] 1px→1.2x, 5px→1x, 10px→0.8x（降低倍率避免手機爆版）
- [x] 格線密度隨縮放調整（放大時顯示更細的格線）

### Phase 9 - 手機版面修復 ✅
- [x] 重新設計 TargetPreview 預覽頁面（簡潔現代風格）
- [x] 新增倒數計時動畫（3 秒倒數 + 旋轉環）
- [x] 目標碎片加入呼吸動畫和四角標記
- [x] 響應式縮放預留 header (80px) 和 toolbar (80px) 空間
- [x] 限制最大縮放為 0.9 避免邊緣被切掉

### Phase 10 - 雙指縮放功能 ✅
- [x] 新增 usePinchZoom hook 處理雙指手勢
- [x] 支援雙指縮放（1x ~ 5x）
- [x] 雙指平移視窗（避免與單指拖曳元素衝突）
- [x] 縮放指示器顯示當前倍率
- [x] 重置視圖按鈕
- [x] 預覽按鈕與黃色輔助定位線同步開關
- [x] 過關時自動重置視圖（避免勝利畫面被裁切）

### Phase 11 - 互動回饋與優化 ✅
- [x] 正確角度視覺回饋（青色旋轉動畫，1 秒）
- [x] 正確大小視覺回饋（金色脈衝動畫，1 秒）
- [x] X 軸對齊視覺回饋（紅色垂直線 + 粒子火花爆炸）
- [x] Y 軸對齊視覺回饋（青綠色水平線 + 粒子火花爆炸）
- [x] 增強版粒子效果（40+20 粒子雙波爆發，更大更誇張）
- [x] 位置對齊螢幕震動效果
- [x] 方塊尺寸調整為格線整數倍（100x100, 100x50, 50x100, 50x50）
- [x] 移除方塊圓角（改為直角矩形）
- [x] 縮放步長修正為固定 0.1（確保像素對齊，100px×0.1=10px，50px×0.1=5px）
- [x] 所有關卡 shape 尺寸統一為 50 或 100 的整數倍

## 待擴展功能

1. 音效系統
2. 失敗機制（時間/操作次數限制）
3. 教學關卡
4. 資料持久化（LocalStorage）
5. 實際圖片素材支援
